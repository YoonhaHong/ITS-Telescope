# Config Generator
Creates config files based on tamplates stored in the 'tamplates' directory. 

# Usage
Modify the values in 'RUN_CREATE_CONFIGS.py` and run the script.

The script creates config files for the MOSS testing software and eudaq2. It also creates the eudaq2 data output directories.

## File Structure
At the current state the script creates files with the following file structure.

```
ðŸ“¦ Config Output Directory
â””â”€Â <DEVICE>/
Â Â Â â””â”€Â <HALF_UNIT>_<SETTINGS>/
Â Â Â Â Â Â â””â”€Â <REGION>/
Â Â Â Â Â Â Â Â Â â”œâ”€Â eudaq2/
Â Â Â Â Â Â Â Â Â â””â”€Â fhr_thr/

ðŸ“¦ Data Output Directory
â””â”€Â <DEVICE>/
Â Â Â â””â”€Â <HALF_UNIT>_<SETTINGS>/
Â Â Â Â Â Â â””â”€Â <REGION>/
Â Â Â Â Â Â Â Â Â â””â”€Â <VCASB_VALUE>/
```
Â©generated by [Project Tree Generator](https://woochanleee.github.io/project-tree-generator)

## Warning
The script can potentially create a lot of directories. It will also deletes the content of the current `OUTPUT_DIR` each time it is run.

Disabling these functionalities can be practical when testing the script.

* To avoid creating new config directories each time the script is executed change the `OUTPUT_DIR` parameter to a constant value. Example: `OUTPUT_DIR='./output'`. 
* To avoid creating data output directories set `CREATE_EUDAQ_DATA_DIR=False`.

# Modidfication
The 'RUN_CREATE_CONFIGS.py' works by exectuing the script 'create_configs.py'. So modification must first happen in the 'create_config.py' script.

'create_config.py' calls two functions, one for each of the config files. Each of these functions in turns create an instance of the ConfigGenerator class.

```
RUN_CREATE_CONFIGS.py -> create_configs.py
                         create_configs.py -> create_eudaq2_configs() -> ConfigGenerator
                         create_configs.py -> create_moss_testing_configs() -> ConfigGenerator
```

## ConfigGenerator class
The ConfigGenerator class loads a template file and convert it to a python dictionary. Then it makes changes to the dictionary before exporting it again as a config file. The template can be a either .json, .json5, .conf or .ini file. 

### Modification methods
Generally the ConfigGenerator uses two methods to make changes to the config: 'regex_replace()' and 'set_value()'

`regex_replace(pattern, replace, *sub_cat)` - Uses 'regular expressions' to replace a `pattern` in the config with the `replace` string.

`set_value(param, value, *sub_cat)` - Set the `value` to the parameter specified in the `param` argument. If the parameter don't exits in the config it is created.

`sub_cat*` - Optional argument to specify in what sub-category to implement the change. This is usefull if a parameter in the config is used for several categories, but it is only desirable to change it for one of them. If the sub-categroy doesn't exists it will be created. There can be any number of `sub_cat` argument passed, seperated by commas. 

### TODO
* Implement adding of ts_config.json path to config files.
* Implement adding IDB.

# eudaq2.ini file generation
There is currently no script to generate the eudaq2.ini file, but there is a helper script called 'print_config_list.py' in the 'tools' directory.

'print_config_list.py' accepts any number of dicrtories containing eudaq2 config files and prints all the files in the terminal, seperated by commas. This line can then be copied into the eudaq2.ini file under the `config` entry.

The configs are printed in the order their parent directories was passed. The files are sorted by VCASB value, with the lowest printed first. 

**TODO**: Add option to print in reverse order. Highest VCSAB value first. 

